<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AMFRD Drift Environment v0.1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
    }
    html, body {
      margin: 0;
      padding: 0;
      background: #05060a;
      color: #e8ecff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      height: 100%;
      overflow: hidden;
    }
    #app {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100vw;
    }
    #top-bar {
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 12px;
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      background: radial-gradient(circle at top left, #15192b 0, #05060a 55%);
      border-bottom: 1px solid rgba(143, 179, 255, 0.18);
      box-sizing: border-box;
      flex-shrink: 0;
    }
    #top-bar span.label {
      opacity: 0.7;
    }
    #top-bar span.value {
      font-weight: 500;
      color: #b1c8ff;
      padding-left: 6px;
    }
    #top-bar .group {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    #main {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 2.8fr) minmax(260px, 360px);
      grid-template-rows: 1fr;
      min-height: 0;
      min-width: 0;
    }

    #canvas-container {
      position: relative;
      background: radial-gradient(circle at center, #070b16 0, #020309 60%);
      border-right: 1px solid rgba(143, 179, 255, 0.12);
      min-width: 0;
      min-height: 0;
      overflow: hidden;
    }
    #driftCanvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    #hud-overlay {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 11px;
      line-height: 1.4;
      color: rgba(224, 231, 255, 0.82);
      background: linear-gradient(135deg, rgba(7,10,22,0.7), rgba(16,27,64,0.85));
      border-radius: 6px;
      padding: 6px 8px;
      border: 1px solid rgba(132,167,255,0.6);
      backdrop-filter: blur(10px);
      max-width: 230px;
      pointer-events: none;
    }
    #hud-overlay h1 {
      margin: 0 0 4px 0;
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #e8f0ff;
    }
    #hud-overlay .field {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2px;
    }
    #hud-overlay .label {
      opacity: 0.6;
    }
    #hud-overlay .value {
      color: #9ec1ff;
      padding-left: 6px;
    }
    #hud-overlay .hint {
      margin-top: 4px;
      opacity: 0.6;
      font-size: 10px;
    }

    #side-panel {
      display: flex;
      flex-direction: column;
      height: 100%;
      background: radial-gradient(circle at top, #0b1020 0, #05060a 60%);
      min-width: 0;
    }
    #side-panel-header {
      padding: 10px 12px 4px;
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #9cb4ff;
      border-bottom: 1px solid rgba(143, 179, 255, 0.18);
    }
    #context-meta {
      padding: 8px 12px 6px;
      font-size: 11px;
      border-bottom: 1px solid rgba(143,179,255,0.1);
    }
    #context-meta .meta-line {
      display: flex;
      justify-content: space-between;
      margin-bottom: 3px;
    }
    #context-meta .label {
      opacity: 0.6;
    }
    #context-meta .value {
      color: #d0deff;
    }

    #spotlights {
      padding: 8px 12px 4px;
      font-size: 11px;
      border-bottom: 1px solid rgba(143,179,255,0.1);
    }
    #spotlights-title {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 10px;
      opacity: 0.8;
      margin-bottom: 4px;
      color: #a8c0ff;
    }
    .spotlight-item {
      margin-bottom: 6px;
      padding: 4px 6px;
      border-radius: 5px;
      background: rgba(11, 18, 42, 0.85);
      border: 1px solid rgba(111,146,235,0.4);
    }
    .spotlight-name {
      font-size: 11px;
      font-weight: 500;
      color: #e2e8ff;
    }
    .spotlight-line {
      font-size: 10px;
      opacity: 0.8;
    }

    #log {
      flex: 1;
      padding: 6px 0 8px;
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    #log-inner {
      flex: 1;
      padding: 0 10px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(143,179,255,0.6) rgba(7,10,20,0.9);
    }
    #log-inner::-webkit-scrollbar {
      width: 6px;
    }
    #log-inner::-webkit-scrollbar-thumb {
      background: rgba(143,179,255,0.55);
      border-radius: 3px;
    }
    #log-inner::-webkit-scrollbar-track {
      background: rgba(7,10,20,0.9);
    }
    .log-line {
      white-space: pre;
      margin: 1px 0;
      color: rgba(210, 222, 255, 0.9);
    }
    .log-line.dim {
      opacity: 0.6;
    }

    #footer {
      padding: 5px 10px 8px;
      font-size: 10px;
      border-top: 1px solid rgba(143,179,255,0.18);
      opacity: 0.8;
      line-height: 1.4;
    }
    #footer span.label {
      text-transform: uppercase;
      letter-spacing: 0.14em;
      opacity: 0.7;
    }
    #footer span.value {
      color: #bcd3ff;
      padding-left: 6px;
    }

    #audio-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 10px;
      margin-top: 3px;
    }
    #audio-bar button {
      border-radius: 999px;
      padding: 3px 10px;
      border: 1px solid rgba(143,179,255,0.7);
      background: rgba(9,14,35,0.9);
      color: #d7e3ff;
      font-size: 10px;
      cursor: pointer;
    }
    #audio-bar button:hover {
      background: rgba(21,32,72,0.95);
    }

    @media (max-width: 780px) {
      #main {
        grid-template-columns: 1fr;
        grid-template-rows: minmax(0, 1.6fr) minmax(0, 1.3fr);
      }
      #canvas-container {
        border-right: none;
        border-bottom: 1px solid rgba(143, 179, 255, 0.12);
      }
    }
  </style>
</head>
<body>
<div id="app">
  <div id="top-bar">
    <div class="group">
      <span class="label">AMFRD Drift Environment</span>
      <span class="value" id="phaseLabel">Phase: INIT</span>
    </div>
    <div class="group">
      <span class="label">Global Drift</span>
      <span class="value" id="globalDriftLabel">00.0%</span>
      <span class="label">View Time</span>
      <span class="value" id="viewTimeLabel">0s</span>
    </div>
  </div>

  <div id="main">
    <div id="canvas-container">
      <canvas id="driftCanvas"></canvas>
      <div id="hud-overlay">
        <h1>Pattern Snapshot</h1>
        <div class="field">
          <span class="label">Field ID</span>
          <span class="value" id="fieldIdLabel">XR-00</span>
        </div>
        <div class="field">
          <span class="label">Cohesion</span>
          <span class="value" id="cohesionLabel">0%</span>
        </div>
        <div class="field">
          <span class="label">Depth</span>
          <span class="value" id="depthLabel">0.0</span>
        </div>
        <div class="field">
          <span class="label">Drift Mode</span>
          <span class="value" id="modeLabel">CALIBRATION</span>
        </div>
        <div class="hint">
          Generated ambient structure; illustrative only.
        </div>
      </div>
    </div>

    <div id="side-panel">
      <div id="side-panel-header">
        Drift Context
      </div>
      <div id="context-meta">
        <div class="meta-line">
          <span class="label">Universal Field</span>
          <span class="value" id="universalLabel">UF-α0</span>
        </div>
        <div class="meta-line">
          <span class="label">Personal Seed</span>
          <span class="value" id="seedLabel">–</span>
        </div>
        <div class="meta-line">
          <span class="label">Complexity Window</span>
          <span class="value" id="complexityLabel">LOW</span>
        </div>
      </div>

      <div id="spotlights">
        <div id="spotlights-title">Example Pattern Contributors</div>
        <div id="spotlightContainer"></div>
      </div>

      <div id="log">
        <div id="log-inner"></div>
      </div>

      <div id="footer">
        <div>
          <span class="label">Engine</span>
          <span class="value">AMFRD / Geomean Drift v0.1 (illustrative)</span>
        </div>
        <div>
          <span class="label">Contact</span>
          <span class="value">Your analytics / insights contact here</span>
        </div>
        <div id="audio-bar">
          <button id="audioToggle">Play ambient</button>
          <span>Optional ambient layer (loop)</span>
        </div>
        <!-- Replace "ambient.mp3" with your own hosted file if you want audio -->
        <audio id="ambientAudio" src="" loop></audio>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  // -----------------------
  // AMFRD-style parameters
  // -----------------------
  const startTime = performance.now();
  let viewSeconds = 0;
  let globalDrift = 0; // 0-100
  let phase = "INIT";

  // Personal seed: random but stable during the session
  const personalSeed = Math.floor(Math.random() * 899999 + 100000); // 6-digit
  const seedLabel = document.getElementById("seedLabel");
  seedLabel.textContent = "PS-" + personalSeed.toString().slice(-4);

  function pseudoRandom(seed) {
    // simple deterministic-ish PRNG based on seed
    let x = Math.sin(seed) * 10000;
    return x - Math.floor(x);
  }

  // Creator "spotlights" (ethical, illustrative only)
  const creators = [
    {
      name: "Creator A",
      match: 0.83,
      trait: "Visual rhythm alignment"
    },
    {
      name: "Creator B",
      match: 0.77,
      trait: "Mid-frequency temporal pacing"
    },
    {
      name: "Creator C",
      match: 0.69,
      trait: "Pattern cohesion signature"
    },
    {
      name: "Creator D",
      match: 0.72,
      trait: "Topic clustering resonance"
    },
    {
      name: "Creator E",
      match: 0.81,
      trait: "Format overlap structure"
    }
  ];

  // -----------------------
  // DOM references
  // -----------------------
  const phaseLabel = document.getElementById("phaseLabel");
  const globalDriftLabel = document.getElementById("globalDriftLabel");
  const viewTimeLabel = document.getElementById("viewTimeLabel");
  const fieldIdLabel = document.getElementById("fieldIdLabel");
  const cohesionLabel = document.getElementById("cohesionLabel");
  const depthLabel = document.getElementById("depthLabel");
  const modeLabel = document.getElementById("modeLabel");
  const universalLabel = document.getElementById("universalLabel");
  const complexityLabel = document.getElementById("complexityLabel");
  const spotlightContainer = document.getElementById("spotlightContainer");
  const logInner = document.getElementById("log-inner");
  const audioToggle = document.getElementById("audioToggle");
  const ambientAudio = document.getElementById("ambientAudio");

  // -----------------------
  // Audio toggle
  // -----------------------
  audioToggle.addEventListener("click", () => {
    if (!ambientAudio.src) {
      // user can host an mp3 somewhere and paste URL here later
      // leaving blank by default keeps it silent but wired
      alert("No audio source set yet. Edit index.html and set the 'src' of #ambientAudio to your ambient file URL.");
      return;
    }
    if (ambientAudio.paused) {
      ambientAudio.play().catch(() => {});
      audioToggle.textContent = "Pause ambient";
    } else {
      ambientAudio.pause();
      audioToggle.textContent = "Play ambient";
    }
  });

  // -----------------------
  // Spotlight rotation
  // -----------------------
  function updateSpotlights(t) {
    // choose 3 creators based on time + seed
    const count = 3;
    spotlightContainer.innerHTML = "";
    for (let i = 0; i < count; i++) {
      const idx = Math.floor((t / 7000 + i * 0.37 + pseudoRandom(personalSeed + i * 19)) % creators.length);
      const c = creators[(idx + creators.length) % creators.length];
      const div = document.createElement("div");
      div.className = "spotlight-item";

      const name = document.createElement("div");
      name.className = "spotlight-name";
      name.textContent = c.name + " — Fit: " + Math.round(c.match * 100) + "%";

      const line = document.createElement("div");
      line.className = "spotlight-line";
      line.textContent = c.trait;

      div.appendChild(name);
      div.appendChild(line);
      spotlightContainer.appendChild(div);
    }
  }

  // -----------------------
  // Log handling
  // -----------------------
  function pushLog(line, dim=false) {
    const el = document.createElement("div");
    el.className = "log-line" + (dim ? " dim" : "");
    el.textContent = line;
    logInner.appendChild(el);
    // keep last ~80 lines
    while (logInner.children.length > 80) {
      logInner.removeChild(logInner.firstChild);
    }
    logInner.scrollTop = logInner.scrollHeight;
  }

  pushLog("[BOOT] AMFRD drift environment v0.1");
  pushLog("[INIT] Universal field anchor: UF-α0");
  pushLog("[INIT] Personal modulation seed: PS-" + personalSeed.toString().slice(-4), true);

  // -----------------------
  // Drift canvas animation
  // -----------------------
  const canvas = document.getElementById("driftCanvas");
  const ctx = canvas.getContext("2d");

  let width = 0;
  let height = 0;
  function resize() {
    width = canvas.clientWidth;
    height = canvas.clientHeight;
    canvas.width = width * window.devicePixelRatio;
    canvas.height = height * window.devicePixelRatio;
    ctx.setTransform(window.devicePixelRatio, 0, 0, window.devicePixelRatio, 0, 0);
  }
  window.addEventListener("resize", resize);
  resize();

  // "Particles" in an abstract field
  const particleCountBase = 70;
  const particles = [];
  for (let i = 0; i < 160; i++) {
    const s = personalSeed + i * 97;
    particles.push({
      px: pseudoRandom(s) * 2 * Math.PI,
      py: pseudoRandom(s + 1) * 2 * Math.PI,
      speed: 0.0006 + pseudoRandom(s + 2) * 0.0012,
      radius: 12 + pseudoRandom(s + 3) * 40,
      phaseOffset: pseudoRandom(s + 4) * 2 * Math.PI
    });
  }

  function lerp(a, b, t) {
    return a + (b - a) * t;
  }

  function easeInOutQuad(t) {
    return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
  }

  function updateMeta(t) {
    // view time
    viewSeconds = ((performance.now() - startTime) / 1000) | 0;
    viewTimeLabel.textContent = viewSeconds + "s";

    // global drift: start low, increase with time but with soft ceiling
    const timeFactor = Math.min(viewSeconds / 90, 1); // saturate ~90s
    globalDrift = Math.round((0.12 + 0.78 * timeFactor) * 1000) / 10; // 12% -> 90%
    globalDriftLabel.textContent = globalDrift.toFixed(1) + "%";

    // phase determination based on view time
    let newPhase;
    if (viewSeconds < 15) newPhase = "CALIBRATION";
    else if (viewSeconds < 60) newPhase = "DRIFTING";
    else if (viewSeconds < 180) newPhase = "DEEP FIELD";
    else newPhase = "STABLE";

    if (newPhase !== phase) {
      phase = newPhase;
      phaseLabel.textContent = "Phase: " + phase;
      pushLog("[PHASE] Transition -> " + phase);
    }

    // field id as pseudo-random code
    const fieldIdx = Math.floor((t / 13000 + personalSeed) % 97);
    fieldIdLabel.textContent = "XR-" + (fieldIdx < 10 ? "0" + fieldIdx : fieldIdx);

    // cohesion: mild oscillation around global drift
    const coh = globalDrift + Math.sin(t / 9000 + personalSeed) * 7;
    cohesionLabel.textContent = Math.max(0, Math.min(100, coh)).toFixed(1) + "%";

    // depth: function of view time + internal clock
    const baseDepth = lerp(0.4, 1.8, Math.min(viewSeconds / 240, 1));
    const modDepth = baseDepth + Math.sin(t / 7000 + personalSeed / 10) * 0.2;
    depthLabel.textContent = modDepth.toFixed(2);

    // mode label
    modeLabel.textContent = phase;

    // universal field label slight variation
    const ufIndex = ["α0","α1","β0","β2","γ1"][Math.floor((t / 30000 + personalSeed) % 5)];
    universalLabel.textContent = "UF-" + ufIndex;

    // complexity window textual
    const complexity = modDepth < 0.8 ? "LOW" : (modDepth < 1.3 ? "MEDIUM" : "HIGH";
    complexityLabel.textContent = complexity;
  }

  function draw(t) {
    updateMeta(t);
    updateSpotlights(t);

    const time = t / 1000;
    const viewFactor = Math.min(viewSeconds / 240, 1); // 0 -> 1 based on view time
    const complexityScale = 0.5 + 1.5 * viewFactor; // how complex visuals become

    // Clear & background
    ctx.clearRect(0, 0, width, height);
    const gradient = ctx.createRadialGradient(
      width * 0.5, height * 0.5, 0,
      width * 0.5, height * 0.5, Math.max(width, height) * 0.7
    );
    gradient.addColorStop(0, "#050712");
    gradient.addColorStop(1, "#020309");
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, width, height);

    // Draw "field" layers
    const activeCount = Math.floor(particleCountBase * (0.6 + complexityScale));
    for (let i = 0; i < activeCount && i < particles.length; i++) {
      const p = particles[i];
      const localTime = time * p.speed * (1.0 + complexityScale * 0.4);

      const cx = width * 0.5 + Math.cos(p.px + localTime + p.phaseOffset * 0.5) * p.radius * (1.5 + complexityScale);
      const cy = height * 0.5 + Math.sin(p.py + localTime * 1.2) * p.radius * (1.5 + complexityScale * 0.6);

      const distNorm = Math.hypot(cx - width * 0.5, cy - height * 0.5) / (Math.max(width, height) * 0.6);
      const alpha = 0.09 + (1 - Math.min(distNorm, 1)) * 0.2 * (0.8 + 0.4 * viewFactor);

      const hueBase = (personalSeed % 360);
      const hue = (hueBase + i * 3 + time * 6 * (0.4 + viewFactor)) % 360;
      const sat = 40 + 40 * (0.3 + viewFactor * 0.7);
      const light = 45 + 20 * (1 - distNorm);

      ctx.beginPath();
      ctx.arc(cx, cy, 10 + 18 * (0.2 + complexityScale * 0.2), 0, Math.PI * 2);
      ctx.fillStyle = `hsla(${hue}, ${sat}%, ${light}%, ${alpha})`;
      ctx.fill();

      // connecting lines for some of them
      if (i % 5 === 0) {
        const j = (i + 13) % activeCount;
        const p2 = particles[j];
        const cx2 = width * 0.5 + Math.cos(p2.px + localTime * 0.92) * p2.radius * (1.6 + complexityScale * 0.5);
        const cy2 = height * 0.5 + Math.sin(p2.py + localTime * 1.15) * p2.radius * (1.6 + complexityScale * 0.3);

        const dx = cx2 - cx;
        const dy = cy2 - cy;
        const d = Math.hypot(dx, dy);
        if (d < Math.min(width, height) * 0.65) {
          const lineAlpha = alpha * 0.6 * (1 - d / (Math.min(width, height) * 0.65));
          ctx.beginPath();
          ctx.moveTo(cx, cy);
          ctx.lineTo(cx2, cy2);
          ctx.strokeStyle = `hsla(${hue}, ${sat}%, ${light + 8}%, ${lineAlpha})`;
          ctx.lineWidth = 1;
          ctx.stroke();
        }
      }
    }

    requestAnimationFrame(draw);
  }

  requestAnimationFrame(draw);

  // -----------------------
  // Periodic log events
  // -----------------------
  let lastLogT = 0;
  function logTick(ts) {
    if (ts - lastLogT > 8000) {
      lastLogT = ts;
      const stamp = (viewSeconds + "s").padStart(4, " ");
      const line = `[${stamp}] drift field stabilized @ ` +
        globalDrift.toFixed(1) + "% / depth " + depthLabel.textContent;
      pushLog(line, true);
    }
    requestAnimationFrame(logTick);
  }
  requestAnimationFrame(logTick);

})();
</script>
</body>
</html>